var setTdWidth=function(e){return e?'width="'+e+'"':""},setCategory=function(e,t){var r="";return $.each(e,function(e,a){a.field===t&&("url"===a.category?r=" j_url":"percentage"===a.category?r=" j_percentage":"time"===a.category&&(r=" j_time"))}),r},setTime=function(){var e=$(".j_time");e.each(function(){$(this).html($(this).html()+"s")})},setPercentage=function(){var e=$(".j_percentage");e.each(function(){$(this).html($(this).html()+"%")})},setFormat=function(){setTime(),setPercentage()},tableHeader=function(e){var t='<thead><tr class="j_thead-tr">';return $.each(e,function(e,r){t+="true"===r.sortable?'<td class="j_'+r.field+' sort-td j_sort-td" '+setTdWidth(r.width)+">"+r.name+'<div><span class="sort-up"></span><span class="sort-down"></span></div></td>':'<td class="j_'+r.field+'" '+setTdWidth(r.width)+">"+r.name+"</td>"}),t+="</tr></thead>"},tableBody=function(e){var t="<tbody>";return $.each(e.data,function(r,a){t+="<tr>",$.each(a,function(r,a){t+='<td class="j_'+r+setCategory(e.columns,r)+'">'+a+"</td>"}),t+="</tr>"}),t+="</tbody>"},mergeDesc=function(e,t,r){for(var a=[];e.length>0&&t.length>0;)a.push(parseInt(e[0][r])>parseInt(t[0][r])?e.shift():t.shift());return a.concat(e).concat(t)},mergeAsc=function(e,t,r){for(var a=[];e.length>0&&t.length>0;)a.push(parseInt(e[0][r])<parseInt(t[0][r])?e.shift():t.shift());return a.concat(e).concat(t)},mergeSort=function(e,t,r){if(1===e.length)return e;var a=Math.floor(e.length/2),o=e.slice(0,a),s=e.slice(a);return"desc"===r?mergeDesc(mergeSort(o,t,"desc"),mergeSort(s,t,"desc"),t):mergeAsc(mergeSort(o,t,"asc"),mergeSort(s,t,"asc"),t)},tableResetOperation=function(e){$("tbody").remove(),$("table").append(tableBody(e)),sortOperation(e),setFormat()},resetTableBody=function(e,t){$("tbody").remove();for(var r="<tbody>",a=0;a<e.length;a++)r+="<tr>",$.each(e[a],function(e,a){r+='<td class="j_'+e+setCategory(t,e)+'">'+a+"</td>"}),r+="</tr>";return r+="</tbody>"},sort=function(e,t,r){var a=e.split("<div>")[0],o="";$.each(t.columns,function(e,t){return a===t.name?(o=t.field,!1):void 0});var s=$(".j_wrapper-main-chart");1===s.find(".j_error-show").size()&&$(".j_error-show").remove(),"asc"===r?($("table").append(resetTableBody(mergeSort(t.data,o,"asc"),t.columns)),setFormat()):"desc"===r&&($("table").append(resetTableBody(mergeSort(t.data,o,"desc"),t.columns)),setFormat())},sortOperation=function(e){var t=$(".j_thead-tr");t.find(".sort-active").removeClass("sort-active"),$(document).off("click",".j_sort-td"),$(document).on("click",".j_sort-td",function(r){var a=$(r.target);0===a.find(".sort-active").size()?(t.find(".sort-up").removeClass("sort-active"),t.find(".sort-down").removeClass("sort-active"),a.find(".sort-up").addClass("sort-active"),sort(a.html(),e,"asc")):a.find(".sort-up").hasClass("sort-active")?(a.find(".sort-up").removeClass("sort-active"),a.find(".sort-down").addClass("sort-active"),sort(a.html(),e,"desc")):a.find(".sort-down").hasClass("sort-active")&&(a.find(".sort-down").removeClass("sort-active"),a.find(".sort-up").addClass("sort-active"),sort(a.html(),e,"asc"))})},setTimePicker=function(){var e=$(".j_timePicker"),t=new Date,r=t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate();e.datetimepicker({format:"yyyy-mm-dd",weekStart:1,autoclose:!0,startView:2,minView:2,forceParse:!0,language:"zh-CN"}),e.val(r)},setWorkBreak=function(){$(document).on("click","tbody tr td",function(){for(var e=0;e<$(this).parent().children().length;e++)$(this).parent().children(":eq("+e+")").toggleClass("word-wrap")})},setScroll=function(){$(window).on("scroll",function(){var e=$(".j_scroll-to-top"),t=document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop;t>=75?($(".j_wrapper-nav ul").addClass("scroll-ul"),t>=150?(e.css("display","block"),t>=260?e.css("opacity","1"):e.css("opacity","0")):e.css("display","none")):$(".j_wrapper-nav ul").removeClass("scroll-ul")}),$(document).on("click",".j_scroll-to-top",function(){$("html,body").animate({scrollTop:"0px"},800)})},setMainNavTimeRequest=function(e){$(".j_wrapper-main-nav-time").on("click","li",function(){$(this).hasClass(".active")||($(this).parent().find(".active").removeClass("active"),$(this).addClass("active")),$.ajax({url:e,type:"POST",dataType:"json",data:{time:$(this).data("time")},success:function(e){var t=$(".j_wrapper-main-chart");1===t.find(".j_error-show").size()&&$(".j_error-show").remove(),tableResetOperation(e)},error:function(e){var t=$(".j_wrapper-main-chart");if(0===t.find(".j_error-show").size()){$(".j_wrapper-main-chart table tbody").remove();var r='<div class="j_error-show error-show">本页面无数据</div>';t.append(r),sortOperation(e)}}})})},setTimePickerRequest=function(e){$(".j_timePicker").on("change",function(){$(".j_wrapper-main-nav-time").find(".active").removeClass("active"),$.ajax({url:e,type:"POST",dataType:"json",data:{time:$(this).val()},success:function(e){var t=$(".j_wrapper-main-chart");1===t.find(".j_error-show").size()&&$(".j_error-show").remove(),tableResetOperation(e)},error:function(e){var t=$(".j_wrapper-main-chart");if(0===t.find(".j_error-show").size()){$(".j_wrapper-main-chart table tbody").remove();var r='<div class="j_error-show error-show">本页面无数据</div>';t.append(r),sortOperation(e)}}})})},setPortPickerRequest=function(e){$(".j_port-picker").on("click",'input[name="portPicker"]',function(){$.ajax({url:e,type:"POST",dataType:"json",data:{port:$(this).val()},success:function(e){var t=$(".j_wrapper-main-chart");1===t.find(".j_error-show").size()&&$(".j_error-show").remove(),tableResetOperation(e)},error:function(e){var t=$(".j_wrapper-main-chart");if(0===t.find(".j_error-show").size()){$(".j_wrapper-main-chart table tbody").remove();var r='<div class="j_error-show error-show">本页面无数据</div>';t.append(r),sortOperation(e)}}})})},tableOperation=function(e){var t="<table>"+tableHeader(e.columns)+tableBody(e)+"</table>";$(".j_wrapper-main-chart").append(t),sortOperation(e),setWorkBreak(),setFormat()},dataAnalysisTable=function(e){$.ajax({url:e,type:"POST",dataType:"json",success:function(e){var t=$(".j_wrapper-main-chart");1===t.find(".j_error-show").size()&&$(".j_error-show").remove(),tableOperation(e)},error:function(){var e=$(".j_wrapper-main-chart");if(0===e.find(".j_error-show").size()){$("tbody").remove();var t='<div class="j_error-show error-show">本页面无数据</div>';e.append(t)}}})};